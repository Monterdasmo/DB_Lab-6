<!DOCTYPE HTML>
<html lang="uk" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Реалізація інформаційного та програмного забезпечення - Система управління відкритими даними</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Система управління відкритими даними</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="Реалізація-інформаційного-та-програмного-забезпечення"><a class="header" href="#Реалізація-інформаційного-та-програмного-забезпечення">Реалізація інформаційного та програмного забезпечення</a></h1>
<h2 id="sql-скрипт-для-створення-на-початкового-наповнення-бази-даних"><a class="header" href="#sql-скрипт-для-створення-на-початкового-наповнення-бази-даних">SQL-скрипт для створення на початкового наповнення бази даних</a></h2>
<pre><code class="language-mysql">-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema opendata
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `opendata` ;

-- -----------------------------------------------------
-- Schema opendata
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `opendata` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ;
USE `opendata` ;

-- -----------------------------------------------------
-- Table `opendata`.`role`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`role` ;

CREATE TABLE IF NOT EXISTS `opendata`.`role` (
  `role_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`role_id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`category`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`category` ;

CREATE TABLE IF NOT EXISTS `opendata`.`category` (
  `category_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `parent_categoty_id` INT NULL DEFAULT NULL,
  PRIMARY KEY (`category_id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE,
  INDEX `parent_category_idx` (`parent_categoty_id` ASC) VISIBLE,
  CONSTRAINT `parent_category`
    FOREIGN KEY (`parent_categoty_id`)
    REFERENCES `opendata`.`category` (`parent_categoty_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`data`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`data` ;

CREATE TABLE IF NOT EXISTS `opendata`.`data` (
  `data_id` INT NOT NULL AUTO_INCREMENT,
  `category_id` INT NOT NULL,
  `description` LONGTEXT NULL DEFAULT NULL,
  `createdAt` DATETIME NOT NULL,
  `updatedAt` DATETIME NOT NULL,
  `content` VARCHAR(45) NOT NULL,
  `format` VARCHAR(45) NOT NULL,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`data_id`, `category_id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE,
  INDEX `fk_data_category_idx` (`category_id` ASC) VISIBLE,
  CONSTRAINT `fk_data_category`
    FOREIGN KEY (`category_id`)
    REFERENCES `opendata`.`category` (`category_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`user`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`user` ;

CREATE TABLE IF NOT EXISTS `opendata`.`user` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `firstname` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `lastname` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NOT NULL,
  `login` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`user_id`),
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  UNIQUE INDEX `login_UNIQUE` (`login` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`access`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`access` ;

CREATE TABLE IF NOT EXISTS `opendata`.`access` (
  `access_id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT NOT NULL,
  `role_id` INT NOT NULL,
  `data_id` INT NOT NULL,
  PRIMARY KEY (`access_id`, `user_id`, `role_id`, `data_id`),
  INDEX `fk_Access_Data_idx` (`data_id` ASC) VISIBLE,
  INDEX `fk_Access_Role_idx` (`role_id` ASC) VISIBLE,
  INDEX `fk_Access_User_idx` (`user_id` ASC) VISIBLE,
  CONSTRAINT `fk_Access_Data`
    FOREIGN KEY (`data_id`)
    REFERENCES `opendata`.`data` (`data_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Access_Role`
    FOREIGN KEY (`role_id`)
    REFERENCES `opendata`.`role` (`role_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Access_User`
    FOREIGN KEY (`user_id`)
    REFERENCES `opendata`.`user` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`tag`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`tag` ;

CREATE TABLE IF NOT EXISTS `opendata`.`tag` (
  `tag_id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`tag_id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `opendata`.`link`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `opendata`.`link` ;

CREATE TABLE IF NOT EXISTS `opendata`.`link` (
  `link_id` INT NOT NULL AUTO_INCREMENT,
  `data_id` INT NOT NULL,
  `tag_id` INT NOT NULL,
  PRIMARY KEY (`link_id`, `data_id`, `tag_id`),
  INDEX `fk_link_data_idx` (`data_id` ASC) VISIBLE,
  INDEX `fk_link_tag_idx` (`tag_id` ASC) VISIBLE,
  CONSTRAINT `fk_link_data`
    FOREIGN KEY (`data_id`)
    REFERENCES `opendata`.`data` (`data_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_link_tag`
    FOREIGN KEY (`tag_id`)
    REFERENCES `opendata`.`tag` (`tag_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `opendata`.`role`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`role` (`role_id`, `name`) VALUES (DEFAULT, 'User');
INSERT INTO `opendata`.`role` (`role_id`, `name`) VALUES (DEFAULT, 'Admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`category`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`category` (`category_id`, `name`, `parent_categoty_id`) VALUES (DEFAULT,, 'Informatics', NULL);
INSERT INTO `opendata`.`category` (`category_id`, `name`, `parent_categoty_id`) VALUES (DEFAULT,, 'Statistics', NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`data`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`data` (`data_id`, `category_id`, `description`, `createdAt`, `updatedAt`, `content`, `format`, `name`) VALUES (DEFAULT,, 1, 'Important tasks', '2023-02-15 15:15:15', '2023-03-15 15:15:15', 'txt', 'txt', 'Informatics');
INSERT INTO `opendata`.`data` (`data_id`, `category_id`, `description`, `createdAt`, `updatedAt`, `content`, `format`, `name`) VALUES (DEFAULT,, 2, 'Important statistics', '2024-04-18 13:17:09', '2024-04-19 13:17:09', 'xlsx', 'xlsx', 'Statistics');

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`user`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`user` (`user_id`, `firstname`, `password`, `lastname`, `email`, `login`) VALUES (DEFAULT, 'Vlad', '1234', 'Koleso', 'vald_koleso@gmail.com', 'vlad');
INSERT INTO `opendata`.`user` (`user_id`, `firstname`, `password`, `lastname`, `email`, `login`) VALUES (DEFAULT, 'Daria', '5678', 'Minze', 'minze@gmail.com', 'minze');

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`access`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`access` (`access_id`, `user_id`, `role_id`, `data_id`) VALUES (DEFAULT, 1, 1, 1);
INSERT INTO `opendata`.`access` (`access_id`, `user_id`, `role_id`, `data_id`) VALUES (DEFAULT, 2, 2, 2);

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`tag`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`tag` (`tag_id`, `name`) VALUES (DEFAULT, 'informatics');
INSERT INTO `opendata`.`tag` (`tag_id`, `name`) VALUES (DEFAULT,, 'statistics');

COMMIT;


-- -----------------------------------------------------
-- Data for table `opendata`.`link`
-- -----------------------------------------------------
START TRANSACTION;
USE `opendata`;
INSERT INTO `opendata`.`link` (`link_id`, `data_id`, `tag_id`) VALUES (DEFAULT, 1, 1);
INSERT INTO `opendata`.`link` (`link_id`, `data_id`, `tag_id`) VALUES (DEFAULT, 2, 2);

COMMIT;

</code></pre>
<h2 id="restfull-сервіс-для-управління-даними"><a class="header" href="#restfull-сервіс-для-управління-даними">RESTfull сервіс для управління даними</a></h2>
<h3 id="Схема-бази-даних-prisma-orm"><a class="header" href="#Схема-бази-даних-prisma-orm">Схема бази даних Prisma ORM</a></h3>
<pre><code class="language-prisma">// This is your Prisma schema file for the OpenData system
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Role {
  roleId   Int      @id @default(autoincrement()) @map("role_id")
  name     String   @unique @db.VarChar(45)
  accesses Access[]

  @@map("role")
}

model Category {
  categoryId       Int        @id @default(autoincrement()) @map("category_id")
  name             String     @unique @db.VarChar(45)
  parentCategoryId Int?       @map("parent_category_id")
  parentCategory   Category?  @relation("CategoryToCategory", fields: [parentCategoryId], references: [categoryId])
  subCategories    Category[] @relation("CategoryToCategory")
  data             Data[]

  @@index([parentCategoryId])
  @@map("category")
}

model Data {
  dataId      Int      @id @default(autoincrement()) @map("data_id")
  categoryId  Int      @map("category_id")
  description String?  @db.LongText
  createdAt   DateTime @db.DateTime(0)
  updatedAt   DateTime @db.DateTime(0)
  content     String   @db.VarChar(45)
  format      String   @db.VarChar(45)
  name        String   @unique @db.VarChar(45)
  category    Category @relation(fields: [categoryId], references: [categoryId])
  accesses    Access[]
  links       Link[]

  @@index([categoryId])
  @@map("data")
}

model User {
  userId    Int      @id @default(autoincrement()) @map("user_id")
  firstname String   @db.VarChar(45)
  password  String   @db.VarChar(255) // Increased to accommodate bcrypt hash
  lastname  String   @db.VarChar(45)
  email     String   @unique @db.VarChar(100) // Also increased email length
  login     String   @unique @db.VarChar(45)
  accesses  Access[]

  @@map("user")
}

model Access {
  accessId Int  @id @default(autoincrement()) @map("access_id")
  userId   Int  @map("user_id")
  roleId   Int  @map("role_id")
  dataId   Int  @map("data_id")
  user     User @relation(fields: [userId], references: [userId])
  role     Role @relation(fields: [roleId], references: [roleId])
  data     Data @relation(fields: [dataId], references: [dataId])

  @@index([userId])
  @@index([roleId])
  @@index([dataId])
  @@map("access")
}

model Tag {
  tagId Int    @id @default(autoincrement()) @map("tag_id")
  name  String @unique @db.VarChar(45)
  links Link[]

  @@map("tag")
}

model Link {
  linkId Int  @id @default(autoincrement()) @map("link_id")
  dataId Int  @map("data_id")
  tagId  Int  @map("tag_id")
  data   Data @relation(fields: [dataId], references: [dataId])
  tag    Tag  @relation(fields: [tagId], references: [tagId])

  @@index([dataId])
  @@index([tagId])
  @@map("link")
}
</code></pre>
<h3 id="Головний-файл-програми"><a class="header" href="#Головний-файл-програми">Головний файл програми</a></h3>
<pre><code class="language-ts">import { NestFactory } from '@nestjs/core'
import { ValidationPipe } from '@nestjs/common'
import { AppModule } from './app.module'
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger'

async function bootstrap() {
	const app = await NestFactory.create(AppModule)

	const port = process.env.PORT || 3000

	app.useGlobalPipes(
		new ValidationPipe({
			whitelist: true,
			transform: true,
		})
	)

	const config = new DocumentBuilder()
		.setTitle('DB-6 API')
		.setDescription('The DB-6 API description')
		.setVersion('1.0')
		.build()

	const documentFactory = () =&gt; SwaggerModule.createDocument(app, config)
	SwaggerModule.setup('api', app, documentFactory)

	await app.listen(port)

	console.info(`Started server on 127.0.0.1:${port}`)
}
bootstrap()
</code></pre>
<h3 id="mодулі-програми"><a class="header" href="#mодулі-програми">Mодулі програми</a></h3>
<h4 id="Головний-модуль"><a class="header" href="#Головний-модуль">Головний модуль</a></h4>
<pre><code class="language-ts">import { Module } from '@nestjs/common'
import { ConfigModule } from '@nestjs/config'
import { ApiModule } from './api/api.module'

@Module({
	imports: [
		ConfigModule.forRoot({
			isGlobal: true,
		}),
		ApiModule,
	],
	controllers: [],
	providers: [],
})
export class AppModule {}
</code></pre>
<h4 id="Головний-модуль-api"><a class="header" href="#Головний-модуль-api">Головний модуль API</a></h4>
<pre><code class="language-ts">import { Module } from '@nestjs/common'
import { TagModule } from './modules/tag.module'
import { UserModule } from './modules/user.module'

@Module({
	imports: [UserModule, TagModule],
})
export class ApiModule {}
</code></pre>
<h4 id="user-модуль"><a class="header" href="#user-модуль">User модуль</a></h4>
<pre><code class="language-ts">import { Module } from '@nestjs/common'
import { UserRepository } from 'src/database/repositories/user.repository'
import { UserController } from '../controllers/user.controller'
import { UserService } from '../services/user.service'
import { PrismaModule } from './prisma.module'

@Module({
	imports: [PrismaModule],
	controllers: [UserController],
	providers: [UserService, UserRepository],
	exports: [UserService],
})
export class UserModule {}
</code></pre>
<h4 id="tag-модуль"><a class="header" href="#tag-модуль">Tag модуль</a></h4>
<pre><code class="language-ts">import { Module } from '@nestjs/common'
import { TagRepository } from 'src/database/repositories/tag.repository'
import { TagController } from '../controllers/tag.controller'
import { TagService } from '../services/tag.service'
import { PrismaModule } from './prisma.module'

@Module({
	imports: [PrismaModule],
	controllers: [TagController],
	providers: [TagService, TagRepository],
	exports: [TagService],
})
export class TagModule {}
</code></pre>
<h3 id="Сервіси-програми"><a class="header" href="#Сервіси-програми">Сервіси програми</a></h3>
<h4 id="user-сервіс"><a class="header" href="#user-сервіс">User сервіс</a></h4>
<pre><code class="language-ts">import {
	ConflictException,
	Injectable,
	NotFoundException,
} from '@nestjs/common'
import * as bcrypt from 'bcrypt'
import { UserRepository } from 'src/database/repositories/user.repository'
import { CreateUserDto } from 'src/shared/dto/create-user.dto'
import { UpdateUserDto } from 'src/shared/dto/update-user.dto'
import { UserResponseDto } from 'src/shared/dto/user-response.dto'

@Injectable()
export class UserService {
	constructor(private readonly userRepository: UserRepository) {}

	async findAll(): Promise&lt;UserResponseDto[]&gt; {
		const users = await this.userRepository.findAll()
		return users.map(this.mapToResponseDto)
	}

	async findOne(id: number): Promise&lt;UserResponseDto&gt; {
		const user = await this.userRepository.findById(id)

		if (!user) {
			throw new NotFoundException(`User with ID ${id} not found`)
		}

		return this.mapToResponseDto(user)
	}

	async create(createUserDto: CreateUserDto): Promise&lt;UserResponseDto&gt; {
		const existingUserByEmail = await this.userRepository.findByEmail(
			createUserDto.email
		)
		if (existingUserByEmail) {
			throw new ConflictException('Email already exists')
		}

		const existingUserByLogin = await this.userRepository.findByLogin(
			createUserDto.login
		)
		if (existingUserByLogin) {
			throw new ConflictException('Login already exists')
		}

		const hashedPassword = await bcrypt.hash(createUserDto.password, 10)

		const user = await this.userRepository.create({
			...createUserDto,
			password: hashedPassword,
		})

		return this.mapToResponseDto(user)
	}

	async update(
		id: number,
		updateUserDto: UpdateUserDto
	): Promise&lt;UserResponseDto&gt; {
		const existingUser = await this.userRepository.findById(id)
		if (!existingUser) {
			throw new NotFoundException(`User with ID ${id} not found`)
		}

		if (updateUserDto.email &amp;&amp; updateUserDto.email !== existingUser.email) {
			const userWithEmail = await this.userRepository.findByEmail(
				updateUserDto.email
			)
			if (userWithEmail) {
				throw new ConflictException('Email already exists')
			}
		}

		if (updateUserDto.login &amp;&amp; updateUserDto.login !== existingUser.login) {
			const userWithLogin = await this.userRepository.findByLogin(
				updateUserDto.login
			)
			if (userWithLogin) {
				throw new ConflictException('Login already exists')
			}
		}

		if (updateUserDto.password) {
			updateUserDto.password = await bcrypt.hash(updateUserDto.password, 10)
		}

		const user = await this.userRepository.update(id, updateUserDto)
		return this.mapToResponseDto(user)
	}

	async remove(id: number): Promise&lt;void&gt; {
		const user = await this.userRepository.findById(id)

		if (!user) {
			throw new NotFoundException(`User with ID ${id} not found`)
		}

		await this.userRepository.delete(id)
	}

	async validateUser(
		login: string,
		password: string
	): Promise&lt;UserResponseDto | null&gt; {
		const user = await this.userRepository.findByLogin(login)

		if (user &amp;&amp; (await bcrypt.compare(password, user.password))) {
			return this.mapToResponseDto(user)
		}

		return null
	}

	private mapToResponseDto(user: any): UserResponseDto {
		const { password, ...userWithoutPassword } = user
		return userWithoutPassword
	}
}
</code></pre>
<h4 id="tag-сервіс"><a class="header" href="#tag-сервіс">Tag сервіс</a></h4>
<pre><code class="language-ts">// src/services/tag.service.ts
import {
	ConflictException,
	Injectable,
	NotFoundException,
} from '@nestjs/common'
import { TagRepository } from 'src/database/repositories/tag.repository'
import { CreateTagDto } from 'src/shared/dto/create-tag.dto'
import { TagResponseDto } from 'src/shared/dto/response-tag.dto'
import { UpdateTagDto } from 'src/shared/dto/update-tag.dto'

@Injectable()
export class TagService {
	constructor(private readonly tagRepository: TagRepository) {}

	async findAll(): Promise&lt;TagResponseDto[]&gt; {
		const tags = await this.tagRepository.findAll()
		return tags.map(this.mapToResponseDto)
	}

	async findOne(id: number): Promise&lt;TagResponseDto&gt; {
		const tag = await this.tagRepository.findById(id)

		if (!tag) {
			throw new NotFoundException(`Tag with ID ${id} not found`)
		}

		return this.mapToResponseDto(tag)
	}

	async create(createTagDto: CreateTagDto): Promise&lt;TagResponseDto&gt; {
		// Check if tag name already exists
		const existingTag = await this.tagRepository.findByName(createTagDto.name)
		if (existingTag) {
			throw new ConflictException(
				`Tag with name '${createTagDto.name}' already exists`
			)
		}

		const tag = await this.tagRepository.create(createTagDto)
		return this.mapToResponseDto(tag)
	}

	async update(
		id: number,
		updateTagDto: UpdateTagDto
	): Promise&lt;TagResponseDto&gt; {
		const existingTag = await this.tagRepository.findById(id)
		if (!existingTag) {
			throw new NotFoundException(`Tag with ID ${id} not found`)
		}

		if (updateTagDto.name &amp;&amp; updateTagDto.name !== existingTag.name) {
			const tagWithName = await this.tagRepository.findByName(updateTagDto.name)
			if (tagWithName) {
				throw new ConflictException(
					`Tag with name '${updateTagDto.name}' already exists`
				)
			}
		}

		const tag = await this.tagRepository.update(id, updateTagDto)
		return this.mapToResponseDto(tag)
	}

	async remove(id: number): Promise&lt;void&gt; {
		const tag = await this.tagRepository.findById(id)

		if (!tag) {
			throw new NotFoundException(`Tag with ID ${id} not found`)
		}

		if (tag._count.links &gt; 0) {
			throw new ConflictException(
				`Cannot delete tag with ID ${id} because it has ${tag._count.links} associated links`
			)
		}

		await this.tagRepository.delete(id)
	}

	async search(searchTerm: string): Promise&lt;TagResponseDto[]&gt; {
		const tags = await this.tagRepository.search(searchTerm)
		return tags.map(tag =&gt; this.mapToResponseDto(tag))
	}

	async findWithLinks(id: number): Promise&lt;any&gt; {
		const tag = await this.tagRepository.findWithLinks(id)

		if (!tag) {
			throw new NotFoundException(`Tag with ID ${id} not found`)
		}

		return tag
	}

	private mapToResponseDto(tag: any): TagResponseDto {
		return {
			tagId: tag.tagId,
			name: tag.name,
			linkCount: tag._count?.links || 0,
		}
	}
}
</code></pre>
<h3 id="Контролери-програми"><a class="header" href="#Контролери-програми">Контролери програми</a></h3>
<h4 id="user-контролер"><a class="header" href="#user-контролер">User контролер</a></h4>
<pre><code class="language-ts">// src/controllers/user.controller.ts
import {
	Body,
	Controller,
	Delete,
	Get,
	HttpCode,
	HttpStatus,
	Param,
	ParseIntPipe,
	Post,
	Put,
	ValidationPipe,
} from '@nestjs/common'
import { CreateUserDto } from 'src/shared/dto/create-user.dto'
import { UpdateUserDto } from 'src/shared/dto/update-user.dto'
import { UserResponseDto } from 'src/shared/dto/user-response.dto'
import { UserService } from '../services/user.service'

@Controller('api/users')
export class UserController {
	constructor(private readonly userService: UserService) {}

	@Get()
	async findAll(): Promise&lt;UserResponseDto[]&gt; {
		return this.userService.findAll()
	}

	@Get(':id')
	async findOne(
		@Param('id', ParseIntPipe) id: number
	): Promise&lt;UserResponseDto&gt; {
		return this.userService.findOne(id)
	}

	@Post()
	@HttpCode(HttpStatus.CREATED)
	async create(
		@Body(ValidationPipe) createUserDto: CreateUserDto
	): Promise&lt;UserResponseDto&gt; {
		return this.userService.create(createUserDto)
	}

	@Put(':id')
	async update(
		@Param('id', ParseIntPipe) id: number,
		@Body(ValidationPipe) updateUserDto: UpdateUserDto
	): Promise&lt;UserResponseDto&gt; {
		return this.userService.update(id, updateUserDto)
	}

	@Delete(':id')
	@HttpCode(HttpStatus.NO_CONTENT)
	async remove(@Param('id', ParseIntPipe) id: number): Promise&lt;void&gt; {
		return this.userService.remove(id)
	}
}
</code></pre>
<h4 id="tag-контролер"><a class="header" href="#tag-контролер">Tag контролер</a></h4>
<pre><code class="language-ts">// src/controllers/tag.controller.ts
import {
	Body,
	Controller,
	Delete,
	Get,
	HttpCode,
	HttpStatus,
	Param,
	ParseIntPipe,
	Post,
	Put,
	Query,
	ValidationPipe,
} from '@nestjs/common'
import { CreateTagDto } from 'src/shared/dto/create-tag.dto'
import { TagResponseDto } from 'src/shared/dto/response-tag.dto'
import { UpdateTagDto } from 'src/shared/dto/update-tag.dto'
import { TagService } from '../services/tag.service'

@Controller('api/tags')
export class TagController {
	constructor(private readonly tagService: TagService) {}

	@Get()
	async findAll(): Promise&lt;TagResponseDto[]&gt; {
		return this.tagService.findAll()
	}

	@Get('search')
	async search(@Query('q') searchTerm: string): Promise&lt;TagResponseDto[]&gt; {
		return this.tagService.search(searchTerm || '')
	}

	@Get(':id')
	async findOne(
		@Param('id', ParseIntPipe) id: number
	): Promise&lt;TagResponseDto&gt; {
		return this.tagService.findOne(id)
	}

	@Get(':id/links')
	async findWithLinks(@Param('id', ParseIntPipe) id: number): Promise&lt;any&gt; {
		return this.tagService.findWithLinks(id)
	}

	@Post()
	@HttpCode(HttpStatus.CREATED)
	async create(
		@Body(ValidationPipe) createTagDto: CreateTagDto
	): Promise&lt;TagResponseDto&gt; {
		return this.tagService.create(createTagDto)
	}

	@Put(':id')
	async update(
		@Param('id', ParseIntPipe) id: number,
		@Body(ValidationPipe) updateTagDto: UpdateTagDto
	): Promise&lt;TagResponseDto&gt; {
		return this.tagService.update(id, updateTagDto)
	}

	@Delete(':id')
	@HttpCode(HttpStatus.NO_CONTENT)
	async remove(@Param('id', ParseIntPipe) id: number): Promise&lt;void&gt; {
		return this.tagService.remove(id)
	}
}
</code></pre>
<h3 id="Репозиторії-програми"><a class="header" href="#Репозиторії-програми">Репозиторії програми</a></h3>
<h4 id="user-репозиторій"><a class="header" href="#user-репозиторій">User репозиторій</a></h4>
<pre><code class="language-ts">// src/repositories/user.repository.ts
import { Injectable } from '@nestjs/common'
import { Prisma, User } from '@prisma/client'
import { PrismaService } from 'src/api/services/prisma.service'

@Injectable()
export class UserRepository {
	constructor(private readonly prisma: PrismaService) {}

	async findAll(): Promise&lt;User[]&gt; {
		return this.prisma.user.findMany({})
	}

	async findById(userId: number): Promise&lt;User | null&gt; {
		return this.prisma.user.findUnique({
			where: { userId },
		})
	}

	async findByEmail(email: string): Promise&lt;User | null&gt; {
		return this.prisma.user.findUnique({
			where: { email },
		})
	}

	async findByLogin(login: string): Promise&lt;User | null&gt; {
		return this.prisma.user.findUnique({
			where: { login },
		})
	}

	async create(data: Prisma.UserCreateInput): Promise&lt;User&gt; {
		return this.prisma.user.create({
			data,
			include: {
				accesses: {
					include: {
						role: true,
						data: true,
					},
				},
			},
		})
	}

	async update(userId: number, data: Prisma.UserUpdateInput): Promise&lt;User&gt; {
		return this.prisma.user.update({
			where: { userId },
			data,
			include: {
				accesses: {
					include: {
						role: true,
						data: true,
					},
				},
			},
		})
	}

	async delete(userId: number): Promise&lt;User&gt; {
		return this.prisma.user.delete({
			where: { userId },
		})
	}

	async count(): Promise&lt;number&gt; {
		return this.prisma.user.count()
	}
}
</code></pre>
<h4 id="tag-репозиторій"><a class="header" href="#tag-репозиторій">Tag репозиторій</a></h4>
<pre><code class="language-ts">// src/repositories/tag.repository.ts
import { Injectable } from '@nestjs/common'
import { Prisma, Tag } from '@prisma/client'
import { PrismaService } from 'src/api/services/prisma.service'

@Injectable()
export class TagRepository {
	constructor(private readonly prisma: PrismaService) {}

	async findAll(): Promise&lt;(Tag &amp; { _count: { links: number } })[]&gt; {
		return this.prisma.tag.findMany({
			include: {
				_count: {
					select: { links: true },
				},
			},
			orderBy: {
				name: 'asc',
			},
		})
	}

	async findById(
		tagId: number
	): Promise&lt;(Tag &amp; { _count: { links: number } }) | null&gt; {
		return this.prisma.tag.findUnique({
			where: { tagId },
			include: {
				_count: {
					select: { links: true },
				},
			},
		})
	}

	async findByName(name: string): Promise&lt;Tag | null&gt; {
		return this.prisma.tag.findUnique({
			where: { name },
		})
	}

	async create(data: Prisma.TagCreateInput): Promise&lt;Tag&gt; {
		return this.prisma.tag.create({
			data,
		})
	}

	async update(tagId: number, data: Prisma.TagUpdateInput): Promise&lt;Tag&gt; {
		return this.prisma.tag.update({
			where: { tagId },
			data,
		})
	}

	async delete(tagId: number): Promise&lt;Tag&gt; {
		return this.prisma.tag.delete({
			where: { tagId },
		})
	}

	async findWithLinks(tagId: number): Promise&lt;(Tag &amp; { links: any[] }) | null&gt; {
		return this.prisma.tag.findUnique({
			where: { tagId },
			include: {
				links: {
					include: {
						data: true,
					},
				},
			},
		})
	}

	async count(): Promise&lt;number&gt; {
		return this.prisma.tag.count()
	}

	async search(searchTerm: string): Promise&lt;Tag[]&gt; {
		return this.prisma.tag.findMany({
			where: {
				name: {
					contains: searchTerm,
				},
			},
			orderBy: {
				name: 'asc',
			},
		})
	}
}
</code></pre>
<h3 id="Підключення-до-бази-даних"><a class="header" href="#Підключення-до-бази-даних">Підключення до бази даних</a></h3>
<h4 id="Модуль"><a class="header" href="#Модуль">Модуль</a></h4>
<pre><code class="language-ts">import { Global, Module } from '@nestjs/common'
import { PrismaService } from '../services/prisma.service'

@Global()
@Module({
	providers: [PrismaService],
	exports: [PrismaService],
})
export class PrismaModule {}
</code></pre>
<h4 id="Сервіс"><a class="header" href="#Сервіс">Сервіс</a></h4>
<pre><code class="language-ts">import { Injectable } from '@nestjs/common'
import { PrismaClient } from '@prisma/client'

@Injectable()
export class PrismaService extends PrismaClient {
	constructor() {
		super({
			datasources: {
				db: {
					url: process.env.DATABASE_URL,
				},
			},
		})
	}
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="design.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="test.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="design.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="test.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
